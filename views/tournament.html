<div class="row">
	<div class="span6">
		<h1>토너먼트 관리</h1>
		
		<form class="well form-inline" method="POST" action="./tournaments">
			<div>
				<input type="text" name="tournament_name" placeholder="토너먼트이름" />
				<div class="btn-group" data-toggle="buttons-radio">
					<button type="button" class="btn">4</button>
					<button type="button" class="btn">8</button>
					<button type="button" class="btn">16</button>
					<button type="button" class="btn">32</button>
				</div> 강
				<input type="hidden" id="tournament_level" name="tournament_level" />
				<input type="submit" class="btn btn-warning" value="생성" />
			</div>
		</form>

		<div id="tournament_view">
		</div>
	</div>

	<div class="span6">	
		<h1>경기장 관리</h1>		
		<form method="POST" class="well form-inline" action="./playground">
			<input type="text" name="playground_num" placeholder="경기장번호" />
			<input type="submit" class="btn btn-warning" value="생성" />
		</form>

		<div class="well">
			<h3>생성된 경기장</h3>
			{% for pg in playgrounds %}
			<button class="btn">경기장 {{pg.playground_num}}</button>
			{% endfor %}
		</div>
	</div>
</div>




<script defer="defer">
$(function(){
	//경기장 설정 button handler
	$(".btn-group button").click(function () {
		$("#tournament_level").val($(this).text());
	});

	$(".btn-group button:first").click();
	
	$.getJSON('tournaments?withDetail=true', function(data){
		console.log(data);
		renderTournaments(data);
	});

	function renderTournaments(tournamentData){
		for (idx in tournamentData) {
			renderTournament(tournamentData[idx]);
		}
	}

	function renderTournament(tournament){
		var targetDiv = $("#tournament_view");
		var fights = tournament.fights;
		var markup = "<h1>"+tournament.tournament_name+"</h1><table class='table table-bordered table-striped tournament-table'>";
		var rowCount = calcRowCount(tournament.tournament_level);
		var tournamentLevel = Math.pow(2, rowCount);
		for (i=0; i<rowCount; i++){
			var colCount = Math.pow(2, i);
			markup += "<tr>";
			for (j=0; j<colCount; j++){
				markup +="<td colspan='"+Math.pow(2,rowCount-(i+1))+"'>"+Math.pow(2,i+1)+"강</td>"
			}
			markup += "</tr>";
			markup += "<tr>";
			for (j=0; j<colCount; j++){
				var fight = "";
				if (i == rowCount-1 && j+1 in fights){
					fight = fights[j+1];
					fight = fight.player1.name + " vs " + fight.player2.name;
				}
				markup +="<td colspan='"+Math.pow(2,rowCount-(i+1))+"'>"+fight+"</td>"
			}
			markup += "</tr>";
		}
		markup += "</table>";
		targetDiv.append($(markup));
	}

	function calcRowCount(tournament_level){
			var rowCount = 0;
			for (i=1; i<tournament_level; i*=2){
				rowCount++;
			}
			return rowCount;
	}
	
});
</script>
